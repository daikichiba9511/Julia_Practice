name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - name: checkout
        uses: actions/checkout@v1

      - name: build Dockerfile
        run: |
          IMAGE_NAME=test_container:${GITHUB_REF#refs/heads/} # docker imageの名前とそのタグ、${GITHUB_REF#refs/heads/}はブランチ名を取得する
          docker build .

      - name: run test
        # TODO: juliaのテストを走らせるコマンドをかく
        run: |
          docker run ${IMAGE_NAME} \
          julia -e"using Base; Base.runtests(tests=["all"]; ncores=ceil(Int, Sys.CPU_THREADS / 2), exit_on_error=false, revise=false, [seed])"

      # TODO: slack通知いれる　https://github.com/marketplace/actions/slack-notify